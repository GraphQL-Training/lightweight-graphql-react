<!DOCTYPE html>
<html>
  <head>
    <title>Lightweight GraphQL | Introduction to GraphQL without window.fetch() | Benjie Gillam</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="styles.css" type='text/css' />
  </head>
  <body>
    <script type="application/javascript" src="remark-latest.min.js"></script>
    <script type="application/javascript">
      async function main() {
        try {
          const result = await fetch('slides.md');
          let lastSource = await result.text();
          const slideshow = remark.create({
            source: lastSource,
            slideNumberFormat: function (current, total) { return null },
            ratio: '4:3',
            highlightLines: true,
            highlightSpans: false // We need ES6 backticks
          });
          if (window.___browserSync___) {
            ___browserSync___.socket.on('reload:slides.md', async () => {
              try {
                const result2 = await fetch('slides.md');
                const newSource = await result2.text();
                if (lastSource !== newSource) {
                  slideshow.gotoSlide(1);
                  slideshow.loadFromString(newSource);
                  let slideNumber = 1;
                  let i = 0, l = Math.min(lastSource.length, newSource.length);
                  for (; i < l; i++) {
                    const oldChr = lastSource[i];
                    const newChr = newSource[i];
                    if (oldChr === '\n') {
                      if (lastSource.substr(i+1, 4).match(/^---?\n/)) {
                        // TODO: don't let this break inside code blocks
                        slideNumber++;
                      }
                    }
                    if (oldChr !== newChr) {
                      slideshow.gotoSlide(slideNumber);
                      break;
                    }
                  }
                  if (i === l) {
                    slideshow.gotoLastSlide();
                  }
                  lastSource = newSource;
                }
              } catch (e) {
                console.error(e);
              }
            })
          }
        } catch (e) {
          document.body.innerHTML = '<h1>An error ocurred!<' + '/h1>';
        }
      }
      window.syntaxWasValid = true;

      main();

    </script>
    <script type="application/javascript">
      if (!window.syntaxWasValid) {
        document.write('<h1>A browser that supports async/await is required to view this presentation</' + 'h1>');
      }
    </script>
  </body>
</html>
